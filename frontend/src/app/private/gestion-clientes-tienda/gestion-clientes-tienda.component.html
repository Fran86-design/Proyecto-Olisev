<app-usaurio-box 
[nombre]="'Juan'" 
[primerApellido]="'PÃ©rez'" 
[tiempoConexion]="'00:15:23'">
</app-usaurio-box>

<h2 class="titulo">ğŸ“‹ GestiÃ³n de Clientes</h2>

<div class="tabla-contenedor">
  <table class="tabla-clientes">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Email</th>
        <th>TelÃ©fono</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      @for (cliente of clientes(); track cliente.email) {
        <tr>
          <td>{{ cliente.nombre }}</td>
          <td>{{ cliente.email }}</td>
          <td>{{ cliente.telefono || 'â€”' }}</td>
          <td class="acciones">
            <button class="btn accion" (click)="abrirModal('pedidos', cliente)">ğŸ“¦ Pedidos</button>
            <button class="btn accion" (click)="abrirModal('facturas', cliente)">ğŸ“„ Facturas</button>
            <button class="btn editar" (click)="abrirModal('editar', cliente)">âœï¸ Editar</button>
            <button class="btn eliminar" (click)="eliminarCliente(cliente)">ğŸ—‘ï¸ Eliminar</button>
          </td>
        </tr>
      }
    </tbody>
  </table>
</div>

@if (modalAbierto()) {
  <div class="modal">
    <div class="modal-contenido">
      <button class="cerrar" (click)="cerrarModal()">âœ–</button>

      @if (modalTipo() === 'pedidos') {
        <h3>ğŸ“¦ Pedidos de {{ clienteActivo()?.nombre }}</h3>
        @if (clienteActivo()?.pedidos?.length > 0) {
          <table class="tabla-modal">
            <thead>
              <tr>
                <th>DirecciÃ³n</th>
                <th>Productos</th>
                <th>Total (â‚¬)</th>
              </tr>
            </thead>
            <tbody>
              @for (p of clienteActivo()?.pedidos; track p.id) {
                <tr>
                  <td>{{ p.direccion }}</td>
                  <td>{{ p.detalles.length }}</td>
                  <td>{{ calcularTotal(p) }}</td>
                </tr>
              }
            </tbody>
          </table>
        } @else {
          <p>Este cliente no tiene pedidos.</p>
        }
      }

      @if (modalTipo() === 'facturas') {
        <h3>ğŸ“„ Facturas de {{ clienteActivo()?.nombre }}</h3>
        @if (clienteActivo()?.pedidos?.length > 0) {
          <table class="tabla-modal">
            <thead>
              <tr>
                <th>ID Pedido</th>
                <th>DirecciÃ³n</th>
                <th>Fecha</th>
                <th>Total</th>
                <th>Descargar</th>
              </tr>
            </thead>
            <tbody>
              @for (pedido of clienteActivo()?.pedidos; track pedido.id) {
                <tr>
                  <td>{{ pedido.id }}</td>
                  <td>{{ pedido.direccion }}</td>
                  <td>{{ pedido.fechaPedido }}</td>
                  <td>{{ calcularTotal(pedido) }} â‚¬</td>
                  <td>
                    <button (click)="descargarFacturas(pedido)">PDF</button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        } @else {
          <p>âŒ Este cliente no tiene facturas disponibles.</p>
        }
      }

      @if (modalTipo() === 'editar') {
        <h3>âœï¸ Editar Cliente</h3>
        <form class="formulario" (submit)="guardarCambios(); $event.preventDefault()">
          <div class="grupo-formulario">
            <label for="nombre">ğŸ‘¤ Nombre</label>
            <input
            id="nombre"
            type="text"
            class="campo"
            [value]="clienteActivo()?.nombre"
            (input)="clienteActivo().nombre = obtenerValor($event)"
            placeholder="Nombre completo"
            required
            />
          </div>

          <div class="grupo-formulario">
            <label for="email">ğŸ“§ Email</label>
            <input
            id="email"
            type="email"
            class="campo"
            [value]="clienteActivo()?.email"
            (input)="clienteActivo().email = obtenerValor($event)"
            placeholder="Correo electrÃ³nico"
            required
            />
          </div>

          <div class="grupo-formulario">
            <label for="telefono">ğŸ“ TelÃ©fono</label>
            <input
            id="telefono"
            type="text"
            class="campo"
            [value]="clienteActivo()?.telefono"
            (input)="clienteActivo().telefono = obtenerValor($event)"
            placeholder="TelÃ©fono"
            />
          </div>

          <div class="acciones-modal">
            <button type="submit" class="btn-guardar">ğŸ’¾ Guardar</button>
            <button type="button" class="btn-cancelar" (click)="cerrarModal()">Cancelar</button>
          </div>
        </form>
      }
    </div>
  </div>
}

@if (alerta.visible) {
  <div class="alerta alerta-{{ alerta.tipo }}">
    <span class="cerrar" (click)="alerta.visible = false">Ã—</span>
    {{ alerta.mensaje }}
  </div>
}


<div class="botones-navegacion">
  <button (click)="irAZonaPrivada()"> Volver a Zona Privada</button>
</div>
